<html>
  <body>
    <div id="stoplight-hub" class="flex h-full h-screen w-full">
      <div id="stoplight-toc" class="border-r"></div>
      <div id="stoplight-page" class="flex-1 overflow-auto"></div>
    </div>

    <script type="text/javascript">
      (function() {
        var platformHost = 'http://localhost:4050';
        var apiHost = 'http://localhost:4060';
        var projectSrn = 'gh/stoplightio/studio-demo';

        var script = document.createElement('script');
        script.type = 'text/javascript';
        script.src = platformHost + '/static/elements/bundle.v1.js';
        script.onload = function() {
          SL.config.host = apiHost;

          SL.config.components = {
            link: ({ node, children }) => {
              const href = /^http/.test(node.url) ? node.url : node.url.replace(projectSrn, '');

              return SL.createElement(
                'a',
                {
                  className: node.className,
                  title: node.title,
                  href,
                  onClick: function(e) {
                    if (!/^http/.test(node.url)) {
                      e.preventDefault();
                      history.pushState({}, node.title, href);
                    }
                  },
                },
                children,
              );
            },
          };

          (function(history) {
            var pushState = history.pushState;
            history.pushState = function(state, title, url) {
              // When the URL is changes, re-render the page component with the new SRN
              SL.elements.page.srn = projectSrn + url;
              SL.elements.toc.srn = projectSrn + url;

              return pushState.apply(history, arguments);
            };
          })(window.history);

          // Render the initial components
          SL.elements.toc.render('stoplight-toc', projectSrn + '/README.md');
          SL.elements.page.render('stoplight-page', projectSrn + '/README.md');
        };

        var styles = document.createElement('link');
        styles.rel = 'stylesheet';
        styles.href = platformHost + '/static/elements/bundle.v1.css';

        var scripts = document.getElementsByTagName('head')[0];
        scripts.appendChild(script, scripts);
        scripts.appendChild(styles, scripts);
      })();
    </script>
  </body>
</html>
